<html>

<head>

</head>

<body>
  <h1>Test Site</h1>
  <button onclick="clickEvent()">Click</button>
  <script>
    let apiBase = "https://api.example.com";

    if (window.location.hostname.indexOf('127.0.0') >= 0 || window.location.hostname === 'localhost') {
      apiBase = "http://localhost:3002";
    }

    const sidKey = 'tsauid';
    let sessionId = localStorage.getItem(sidKey);
    if (!sessionId) {
      sessionId = Math.random().toString(16).slice(2);
      localStorage.setItem(sidKey, sessionId);
    }

    function sendEvent(ev) {
      ev.sessionId = sessionId;
      ev.domain = window.location.hostname;
      fetch(apiBase + '/event', {
        method: 'POST',
        headers: {
          'Accept': 'application/json, text/plain, */*',
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(ev)
      }).then(res => res.json())
        .then(res => console.log(res));
    }

    sendEvent({ key: 'pageview' });

    function clickEvent() {
      sendEvent({ key: 'click' });
    }

  </script>
</body>

</html>